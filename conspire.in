#!/bin/sh
#
# Launcher for conspire.
# This launches conspire's backend (the IRC client), and any user-installed
# servers. In this case, it's installed to `@libdir@/@PACKAGE@'.
#

exec_prefix=@exec_prefix@
libdir=@libdir@/@PACKAGE@

CONSPIRE_INTERFACE=gtk

echo "I: conspire launcher @VERSION@"

if [ -f $HOME/.conspire/launcher_settings ]; then
	. $HOME/.conspire/launcher_settings
	echo "I: Loaded settings from $HOME/.conspire/launcher_settings."
fi

PLUGINDIRS="${libdir} ${userplugindirs}"

echo "I: Starting client."

cmd="conspire-${CONSPIRE_INTERFACE} $*"
echo "I: Command: '$cmd'"
$cmd &

echo "I: Waiting for client to settle."
sleep 3

echo "I: Client started."

echo "I: Starting plugin load."

for dir in $PLUGINDIRS; do
	for server in $dir/*; do
		echo "I: Launching $server.";
		$server &> /dev/null &
	done
done

echo "I: Plugin load complete."

